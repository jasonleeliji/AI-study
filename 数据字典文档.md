# AIå­¦ä¹ ç³»ç»Ÿæ•°æ®å­—å…¸æ–‡æ¡£

## æ¦‚è¿°
æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†AIå­¦ä¹ ç³»ç»Ÿä¸­æ‰€æœ‰æ•°æ®åº“è¡¨çš„ç»“æ„ã€å­—æ®µå®šä¹‰å’Œä¸šåŠ¡å«ä¹‰ã€‚

**ğŸ“‹ æ•°æ®æ¥æºè¯´æ˜**ï¼š
- âœ… **å·²éªŒè¯**ï¼šæœ¬æ–‡æ¡£åŸºäºæ•°æ®åº“æ¨¡å‹æ–‡ä»¶ç”Ÿæˆï¼Œå¹¶ä¸å®é™…æ•°æ®åº“ç»“æ„è¿›è¡Œäº†æ¯”å¯¹éªŒè¯
- ğŸ” **éªŒè¯æ—¶é—´**ï¼š2025å¹´8æœˆ
- ğŸ“Š **å®é™…é›†åˆæ•°é‡**ï¼š10ä¸ªé›†åˆ
- ğŸ¯ **å‡†ç¡®æ€§**ï¼šå­—æ®µåç§°å’Œæ•°æ®ç±»å‹ä¸æ•°æ®åº“å®é™…æƒ…å†µä¸€è‡´

**å®é™…æ•°æ®åº“é›†åˆåˆ—è¡¨**ï¼š
- `users` - ç”¨æˆ·è¡¨
- `childprofiles` - å„¿ç«¥æ¡£æ¡ˆè¡¨  
- `studysessions` - å­¦ä¹ ä¼šè¯è¡¨
- `subscriptions` - è®¢é˜…è¡¨
- `tokenusages` - ä»¤ç‰Œä½¿ç”¨è®°å½•è¡¨
- `appconfigs` - åº”ç”¨é…ç½®è¡¨
- `aipromptconfigs` - AIæç¤ºé…ç½®è¡¨
- `characterconfigs` - è§’è‰²é…ç½®è¡¨
- `feedbackmessages` - åé¦ˆæ¶ˆæ¯è¡¨
- `feedbacks` - ç”¨æˆ·åé¦ˆè¡¨

---

## 1. ç”¨æˆ·è¡¨ (User)
**é›†åˆåç§°**: `users`
**ä¸šåŠ¡æè¿°**: å­˜å‚¨ç³»ç»Ÿç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’Œè´¦æˆ·çŠ¶æ€

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦ |
| phone | String | æ˜¯ | - | ç”¨æˆ·æ‰‹æœºå·ç ï¼ˆ11ä½æ•°å­—ï¼Œå”¯ä¸€ï¼‰ |
| password | String | æ˜¯ | - | ç”¨æˆ·å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰ |
| trialEndDate | Date | å¦ | - | è¯•ç”¨æœŸç»“æŸæ—¥æœŸ |
| subscription | ObjectId | å¦ | - | å…³è”è®¢é˜…è®°å½•ID |
| childProfile | ObjectId | å¦ | - | å…³è”å„¿ç«¥æ¡£æ¡ˆID |
| totalTokensUsed | Number | å¦ | 0 | ç”¨æˆ·ç´¯è®¡ä½¿ç”¨çš„AIä»¤ç‰Œæ•°é‡ |
| totalTokenUsage | Object | å¦ | - | ä»¤ç‰Œä½¿ç”¨ç»Ÿè®¡å¯¹è±¡ï¼ˆåŒ…å«inputã€outputã€totalå­—æ®µï¼‰ |
| dailyRemainingSeconds | Number | å¦ | 0 | æ¯æ—¥å‰©ä½™å­¦ä¹ æ—¶é—´ï¼ˆç§’ï¼‰ |
| lastResetDate | Date | å¦ | å½“å‰æ—¶é—´ | ä¸Šæ¬¡é‡ç½®æ¯æ—¥æ—¶é—´çš„æ—¥æœŸ |
| isParentVerified | Boolean | å¦ | false | å®¶é•¿éªŒè¯çŠ¶æ€ |
| createdAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | åˆ›å»ºæ—¶é—´ |
| updatedAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | æ›´æ–°æ—¶é—´ |

---

## 2. å„¿ç«¥æ¡£æ¡ˆè¡¨ (ChildProfile)
**é›†åˆåç§°**: `childprofiles`
**ä¸šåŠ¡æè¿°**: å­˜å‚¨å„¿ç«¥ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯å’Œå­¦ä¹ é…ç½®

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | æ¡£æ¡ˆå”¯ä¸€æ ‡è¯†ç¬¦ |
| user | ObjectId | æ˜¯ | - | å…³è”ç”¨æˆ·ID |
| nickname | String | æ˜¯ | - | å„¿ç«¥æ˜µç§° |
| age | Number | æ˜¯ | - | å„¿ç«¥å¹´é¾„ |
| grade | String | æ˜¯ | - | å„¿ç«¥å¹´çº§ |
| gender | String | æ˜¯ | - | å„¿ç«¥æ€§åˆ«ï¼ˆboy/girlï¼‰ |
| minSessionDuration | Number | æ˜¯ | - | æœ€å°å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| stretchBreak | Number | æ˜¯ | - | ä¼¸å±•ä¼‘æ¯æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| waterBreak | Number | æ˜¯ | - | å–æ°´ä¼‘æ¯æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| restroomBreak | Number | æ˜¯ | - | å¦‚å•ä¼‘æ¯æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| forcedBreakDuration | Number | æ˜¯ | - | å¼ºåˆ¶ä¼‘æ¯æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| workDurationBeforeForcedBreak | Number | æ˜¯ | - | å¼ºåˆ¶ä¼‘æ¯å‰çš„å·¥ä½œæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| waterBreakLimit | Number | æ˜¯ | - | æ¯æ—¥å–æ°´ä¼‘æ¯æ¬¡æ•°é™åˆ¶ |
| restroomBreakLimit | Number | æ˜¯ | - | æ¯æ—¥å¦‚å•ä¼‘æ¯æ¬¡æ•°é™åˆ¶ |
| gamificationStage | String | å¦ | STONE_MONKEY | æ¸¸æˆåŒ–é˜¶æ®µï¼ˆçŸ³çŒ´/æ´ä¸»/çŒ´ç‹/æ€»çŒ´ç‹ï¼‰ |
| totalSpiritualPower | Number | å¦ | 0 | ç´¯è®¡çµåŠ›å€¼ï¼ˆAIåˆ†ææ¶ˆè€—çš„tokenæ€»å’Œï¼‰ |
| dailySpiritualPower | Number | å¦ | 0 | æ¯æ—¥çµåŠ›å€¼ |
| totalFocusSeconds | Number | å¦ | 0 | ç´¯è®¡ä¸“æ³¨æ—¶é—´ï¼ˆç§’ï¼Œå…¼å®¹æ€§å­—æ®µï¼‰ |
| dailyFocusSeconds | Number | å¦ | 0 | æ¯æ—¥ä¸“æ³¨æ—¶é—´ï¼ˆç§’ï¼‰ |
| lastFocusUpdate | Date | å¦ | å½“å‰æ—¶é—´ | ä¸Šæ¬¡ä¸“æ³¨æ—¶é—´æ›´æ–°æ—¥æœŸ |
| createdAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | åˆ›å»ºæ—¶é—´ |
| updatedAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | æ›´æ–°æ—¶é—´ |

---

## 3. å­¦ä¹ ä¼šè¯è¡¨ (StudySession)
**é›†åˆåç§°**: `studysessions`
**ä¸šåŠ¡æè¿°**: è®°å½•ç”¨æˆ·çš„å­¦ä¹ ä¼šè¯ä¿¡æ¯å’ŒçŠ¶æ€å˜åŒ–

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | ä¼šè¯å”¯ä¸€æ ‡è¯†ç¬¦ |
| user | ObjectId | æ˜¯ | - | å…³è”ç”¨æˆ·ID |
| startTime | Date | æ˜¯ | - | å­¦ä¹ å¼€å§‹æ—¶é—´ |
| endTime | Date | å¦ | - | å­¦ä¹ ç»“æŸæ—¶é—´ |
| status | String | æ˜¯ | STUDYING | å­¦ä¹ çŠ¶æ€ï¼ˆIDLE/STUDYING/PAUSED/BREAK/FINISHEDï¼‰ |
| activeBreakType | String | å¦ | - | å½“å‰ä¼‘æ¯ç±»å‹ï¼ˆSTRETCH/WATER/RESTROOM/FORCEDï¼‰ |
| focusHistory | Array | å¦ | [] | ä¸“æ³¨å†å²è®°å½•æ•°ç»„ |
| focusHistory.timestamp | Date | - | - | è®°å½•æ—¶é—´æˆ³ |
| focusHistory.isFocused | Boolean | - | - | æ˜¯å¦ä¸“æ³¨ |
| focusHistory.isOnSeat | Boolean | - | - | æ˜¯å¦åœ¨åº§ä½ä¸Š |
| breakHistory | Array | å¦ | [] | ä¼‘æ¯å†å²è®°å½•æ•°ç»„ |
| breakHistory.startTime | Date | - | - | ä¼‘æ¯å¼€å§‹æ—¶é—´ |
| breakHistory.endTime | Date | - | - | ä¼‘æ¯ç»“æŸæ—¶é—´ |
| breakHistory.type | String | - | - | ä¼‘æ¯ç±»å‹ |
| lastActivity | Date | å¦ | - | æœ€åæ´»åŠ¨æ—¶é—´ |
| currentRank | String | å¦ | WUKONG | å½“å‰è§’è‰²ç­‰çº§ |
| consecutiveDistractions | Number | å¦ | 0 | è¿ç»­åˆ†å¿ƒæ¬¡æ•° |
| lastFocusTime | Date | å¦ | å½“å‰æ—¶é—´ | æœ€åä¸“æ³¨æ—¶é—´ |
| lastPositiveFeedbackTime | Date | å¦ | å½“å‰æ—¶é—´ | æœ€åæ­£é¢åé¦ˆæ—¶é—´ |
| createdAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | åˆ›å»ºæ—¶é—´ |
| updatedAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | æ›´æ–°æ—¶é—´ |

---

## 4. è®¢é˜…è¡¨ (Subscription)
**é›†åˆåç§°**: `subscriptions`
**ä¸šåŠ¡æè¿°**: ç®¡ç†ç”¨æˆ·çš„è®¢é˜…è®¡åˆ’å’ŒçŠ¶æ€

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | è®¢é˜…å”¯ä¸€æ ‡è¯†ç¬¦ |
| user | ObjectId | æ˜¯ | - | å…³è”ç”¨æˆ·ID |
| plan | String | æ˜¯ | - | è®¢é˜…è®¡åˆ’ï¼ˆtrial/none/standard/proï¼‰ |
| status | String | æ˜¯ | - | è®¢é˜…çŠ¶æ€ï¼ˆactive/inactive/cancelledï¼‰ |
| startDate | Date | æ˜¯ | - | è®¢é˜…å¼€å§‹æ—¥æœŸ |
| endDate | Date | æ˜¯ | - | è®¢é˜…ç»“æŸæ—¥æœŸ |
| alipayTradeNo | String | å¦ | - | æ”¯ä»˜å®äº¤æ˜“å· |
| createdAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | åˆ›å»ºæ—¶é—´ |
| updatedAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | æ›´æ–°æ—¶é—´ |

---

## 5. ä»¤ç‰Œä½¿ç”¨è®°å½•è¡¨ (TokenUsage)
**é›†åˆåç§°**: `tokenusages`
**ä¸šåŠ¡æè¿°**: è®°å½•AIåˆ†æåŠŸèƒ½çš„ä»¤ç‰Œæ¶ˆè€—æƒ…å†µ

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦ |
| user | ObjectId | æ˜¯ | - | å…³è”ç”¨æˆ·ID |
| inputTokens | Number | æ˜¯ | 0 | è¾“å…¥ä»¤ç‰Œæ•°é‡ |
| outputTokens | Number | æ˜¯ | 0 | è¾“å‡ºä»¤ç‰Œæ•°é‡ |
| totalTokens | Number | æ˜¯ | 0 | æ€»ä»¤ç‰Œæ•°é‡ |
| sessionId | ObjectId | å¦ | - | å…³è”å­¦ä¹ ä¼šè¯ID |
| isFocused | Boolean | å¦ | false | è®°å½•tokenæ¶ˆè€—æ—¶ç”¨æˆ·æ˜¯å¦ä¸“æ³¨ |
| createdAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | åˆ›å»ºæ—¶é—´ |

---

## 6. åº”ç”¨é…ç½®è¡¨ (AppConfig)
**é›†åˆåç§°**: `appconfigs`
**ä¸šåŠ¡æè¿°**: å­˜å‚¨åº”ç”¨çš„å…¨å±€é…ç½®ä¿¡æ¯ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | é…ç½®å”¯ä¸€æ ‡è¯†ç¬¦ |
| positiveFeedbackMinutes | Number | æ˜¯ | - | æ­£é¢åé¦ˆé—´éš”æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ |
| standardPlanPrice | Number | æ˜¯ | - | æ ‡å‡†ç‰ˆä»·æ ¼ï¼ˆåˆ†ï¼‰ |
| proPlanPrice | Number | æ˜¯ | - | ä¸“ä¸šç‰ˆä»·æ ¼ï¼ˆåˆ†ï¼‰ |
| feedbackTitleTrial | String | æ˜¯ | - | è¯•ç”¨ç‰ˆåé¦ˆåŒºæ ‡é¢˜ |
| feedbackTitleStandard | String | æ˜¯ | - | æ ‡å‡†ç‰ˆåé¦ˆåŒºæ ‡é¢˜ |
| feedbackTitlePro | String | æ˜¯ | - | ä¸“ä¸šç‰ˆåé¦ˆåŒºæ ‡é¢˜ |
| sleepMessageTrial | String | æ˜¯ | - | è¯•ç”¨ç‰ˆç¡è§‰æç¤ºæ–‡æ¡ˆ |
| sleepMessageStandard | String | æ˜¯ | - | æ ‡å‡†ç‰ˆç¡è§‰æç¤ºæ–‡æ¡ˆ |
| sleepMessagePro | String | æ˜¯ | - | ä¸“ä¸šç‰ˆç¡è§‰æç¤ºæ–‡æ¡ˆ |
| idleMessageTrial | String | æ˜¯ | - | è¯•ç”¨ç‰ˆæœªå¼€å§‹ä¿®è¡Œæç¤ºæ–‡æ¡ˆ |
| idleMessageStandard | String | æ˜¯ | - | æ ‡å‡†ç‰ˆæœªå¼€å§‹ä¿®è¡Œæç¤ºæ–‡æ¡ˆ |
| idleMessagePro | String | æ˜¯ | - | ä¸“ä¸šç‰ˆæœªå¼€å§‹ä¿®è¡Œæç¤ºæ–‡æ¡ˆ |
| stoneMonkeyGoalTokens | Number | æ˜¯ | 100000 | çŸ³çŒ´é˜¶æ®µç›®æ ‡ä»¤ç‰Œæ•° |
| caveMasterGoalTokens | Number | æ˜¯ | 300000 | æ´ä¸»é˜¶æ®µç›®æ ‡ä»¤ç‰Œæ•° |
| monkeyKingGoalTokens | Number | æ˜¯ | 600000 | çŒ´ç‹é˜¶æ®µç›®æ ‡ä»¤ç‰Œæ•° |
| totalMonkeyKingGoalTokens | Number | æ˜¯ | 1200000 | æ€»çŒ´ç‹é˜¶æ®µç›®æ ‡ä»¤ç‰Œæ•° |
| wechatQrImageUrl | String | æ˜¯ | /src/assets/wechat-w.png | å¾®ä¿¡ç¾¤äºŒç»´ç å›¾ç‰‡URL |
| createdAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | åˆ›å»ºæ—¶é—´ |
| updatedAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | æ›´æ–°æ—¶é—´ |

---

## 7. AIæç¤ºé…ç½®è¡¨ (AiPromptConfig)
**é›†åˆåç§°**: `aipromptconfigs`
**ä¸šåŠ¡æè¿°**: é…ç½®ä¸åŒè®¢é˜…è®¡åˆ’çš„AIåˆ†æå‚æ•°

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | é…ç½®å”¯ä¸€æ ‡è¯†ç¬¦ |
| subscriptionPlan | String | æ˜¯ | - | è®¢é˜…è®¡åˆ’ï¼ˆtrial/standard/proï¼‰ï¼Œå”¯ä¸€ |
| promptTemplate | String | æ˜¯ | - | AIæç¤ºæ¨¡æ¿ |
| analysisIntervalSeconds | Number | å¦ | 30 | åˆ†æé—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ |
| maxTokens | Number | å¦ | 150 | æœ€å¤§ä»¤ç‰Œæ•° |
| analysisCategories | Mixed | å¦ | {} | åˆ†æç±»åˆ«é…ç½® |
| distractedSubtypes | Mixed | å¦ | {} | åˆ†å¿ƒå­ç±»å‹é…ç½® |
| isActive | Boolean | å¦ | true | æ˜¯å¦æ¿€æ´» |
| createdAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | åˆ›å»ºæ—¶é—´ |
| updatedAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | æ›´æ–°æ—¶é—´ |

---

## 8. è§’è‰²é…ç½®è¡¨ (CharacterConfig)
**é›†åˆåç§°**: `characterconfigs`
**ä¸šåŠ¡æè¿°**: é…ç½®ä¸åŒè§’è‰²åœ¨å„ç§åœºæ™¯ä¸‹çš„å›¾ç‰‡èµ„æº

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | é…ç½®å”¯ä¸€æ ‡è¯†ç¬¦ |
| role | String | æ˜¯ | - | è§’è‰²ç±»å‹ï¼ˆmaster/studentï¼‰ |
| rank | String | å¦ | - | è§’è‰²ç­‰çº§ï¼ˆwukongï¼‰ |
| gamificationStage | String | å¦ | - | æ¸¸æˆåŒ–é˜¶æ®µ |
| subscriptionPlan | String | æ˜¯ | - | è®¢é˜…è®¡åˆ’ |
| images | Array | å¦ | [] | è§’è‰²å›¾ç‰‡é…ç½®æ•°ç»„ |
| images.imagePath | String | æ˜¯ | - | å›¾ç‰‡è·¯å¾„ |
| images.displayName | String | æ˜¯ | - | æ˜¾ç¤ºåç§° |
| images.description | String | å¦ | - | å›¾ç‰‡æè¿° |
| isActive | Boolean | å¦ | true | æ˜¯å¦æ¿€æ´» |
| createdAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | åˆ›å»ºæ—¶é—´ |
| updatedAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | æ›´æ–°æ—¶é—´ |

**å¤åˆç´¢å¼•**: role + rank + gamificationStage + subscriptionPlanï¼ˆå”¯ä¸€ï¼‰

---

## 9. åé¦ˆæ¶ˆæ¯è¡¨ (FeedbackMessage)
**é›†åˆåç§°**: `feedbackmessages`
**ä¸šåŠ¡æè¿°**: å­˜å‚¨ä¸åŒåœºæ™¯ä¸‹çš„åé¦ˆæ¶ˆæ¯å’Œè¯­éŸ³æ–‡ä»¶

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ç¬¦ |
| characterRank | String | æ˜¯ | - | è§’è‰²ç­‰çº§ï¼ˆwukongï¼‰ |
| subscriptionPlan | String | æ˜¯ | - | è®¢é˜…è®¡åˆ’ |
| studyState | String | æ˜¯ | - | å­¦ä¹ çŠ¶æ€ï¼ˆfocused/distracted/off-seatï¼‰ |
| distractedSubtype | String | å¦ | - | åˆ†å¿ƒå­ç±»å‹ï¼ˆplay/distracted/zone/talk/sleepï¼‰ |
| messages | Array | æ˜¯ | - | åé¦ˆæ¶ˆæ¯æ–‡æœ¬æ•°ç»„ |
| audioUrls | Array | å¦ | - | è¯­éŸ³æ–‡ä»¶URLæ•°ç»„ï¼ˆä¸messagesä¸€ä¸€å¯¹åº”ï¼‰ |
| isActive | Boolean | å¦ | true | æ˜¯å¦æ¿€æ´» |
| createdAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | åˆ›å»ºæ—¶é—´ |
| updatedAt | Date | å¦ | è‡ªåŠ¨ç”Ÿæˆ | æ›´æ–°æ—¶é—´ |

**å¤åˆç´¢å¼•**: characterRank + subscriptionPlan + studyState + distractedSubtypeï¼ˆå”¯ä¸€ï¼‰

---

## 10. ç”¨æˆ·åé¦ˆè¡¨ (Feedback)
**é›†åˆåç§°**: `feedbacks`
**ä¸šåŠ¡æè¿°**: å­˜å‚¨ç”¨æˆ·æäº¤çš„åé¦ˆæ„è§

| å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ | ä¸šåŠ¡å«ä¹‰ |
|--------|----------|----------|--------|---------|
| _id | ObjectId | æ˜¯ | è‡ªåŠ¨ç”Ÿæˆ | åé¦ˆå”¯ä¸€æ ‡è¯†ç¬¦ |
| user | ObjectId | æ˜¯ | - | å…³è”ç”¨æˆ·ID |
| content | String | æ˜¯ | - | åé¦ˆå†…å®¹ï¼ˆæœ€å¤§200å­—ï¼‰ |
| createdAt | Date | å¦ | å½“å‰æ—¶é—´ | åˆ›å»ºæ—¶é—´ |

---

## æšä¸¾å€¼è¯´æ˜

### è®¢é˜…è®¡åˆ’ (SubscriptionPlan)
- `trial`: è¯•ç”¨ç‰ˆ
- `standard`: æ ‡å‡†ç‰ˆ
- `pro`: ä¸“ä¸šç‰ˆ

### å­¦ä¹ çŠ¶æ€ (StudyStatus)
- `IDLE`: ç©ºé—²
- `STUDYING`: å­¦ä¹ ä¸­
- `PAUSED`: æš‚åœ
- `BREAK`: ä¼‘æ¯ä¸­
- `FINISHED`: å·²å®Œæˆ

### ä¼‘æ¯ç±»å‹ (BreakType)
- `STRETCH`: ä¼¸å±•ä¼‘æ¯
- `WATER`: å–æ°´ä¼‘æ¯
- `RESTROOM`: å¦‚å•ä¼‘æ¯
- `FORCED`: å¼ºåˆ¶ä¼‘æ¯

### æ¸¸æˆåŒ–é˜¶æ®µ (GamificationStage)
- `STONE_MONKEY`: çŸ³çŒ´é˜¶æ®µ
- `CAVE_MASTER`: æ´ä¸»é˜¶æ®µ
- `MONKEY_KING`: çŒ´ç‹é˜¶æ®µ
- `TOTAL_MONKEY_KING`: æ€»çŒ´ç‹é˜¶æ®µ

### å­¦ä¹ çŠ¶æ€ (StudyState)
- `focused`: ä¸“æ³¨
- `distracted`: åˆ†å¿ƒ
- `off-seat`: ç¦»åº§

### åˆ†å¿ƒå­ç±»åˆ« (DistractedSubtype)
- `play`: ç©å¼„æ— å…³ç‰©å“
- `distracted`: è§†çº¿é•¿æœŸåç¦»
- `zone`: æ˜æ˜¾å‘å‘†/èµ°ç¥
- `talk`: ä¸äººäº’åŠ¨
- `sleep`: è¶´ç¡æˆ–ç¦»åº§

---

## æ•°æ®å…³ç³»è¯´æ˜

1. **User** â†” **ChildProfile**: ä¸€å¯¹ä¸€å…³ç³»ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªå„¿ç«¥æ¡£æ¡ˆ
2. **User** â†” **Subscription**: ä¸€å¯¹ä¸€å…³ç³»ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªè®¢é˜…è®°å½•
3. **User** â†” **StudySession**: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªå­¦ä¹ ä¼šè¯
4. **User** â†” **TokenUsage**: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šæ¡ä»¤ç‰Œä½¿ç”¨è®°å½•
5. **User** â†” **Feedback**: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æäº¤å¤šæ¡åé¦ˆ
6. **StudySession** â†” **TokenUsage**: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªå­¦ä¹ ä¼šè¯å¯ä»¥å¯¹åº”å¤šæ¡ä»¤ç‰Œä½¿ç”¨è®°å½•

---

## æ•°æ®å­—å…¸éªŒè¯æŠ¥å‘Š

### éªŒè¯æ–¹æ³•
é€šè¿‡ç›´æ¥è¿æ¥MongoDBæ•°æ®åº“ï¼ŒæŸ¥è¯¢æ‰€æœ‰é›†åˆçš„å®é™…å­—æ®µç»“æ„ï¼Œä¸åŸºäºæ¨¡å‹æ–‡ä»¶ç”Ÿæˆçš„æ•°æ®å­—å…¸è¿›è¡Œæ¯”å¯¹ã€‚

### éªŒè¯ç»“æœ
âœ… **é›†åˆåç§°**ï¼šå®Œå…¨ä¸€è‡´ï¼Œå…±10ä¸ªé›†åˆ
âœ… **å­—æ®µåç§°**ï¼š99%ä¸€è‡´ï¼Œå‘ç°1ä¸ªé¢å¤–å­—æ®µ
âœ… **æ•°æ®ç±»å‹**ï¼šå®Œå…¨åŒ¹é…
âœ… **ä¸šåŠ¡é€»è¾‘**ï¼šå­—æ®µå«ä¹‰ä¸å®é™…ä½¿ç”¨åœºæ™¯ä¸€è‡´

### å‘ç°çš„å·®å¼‚
1. **ç”¨æˆ·è¡¨ (users)**ï¼š
   - æ–°å¢å­—æ®µï¼š`totalTokenUsage` (Objectç±»å‹)
   - è¯´æ˜ï¼šå®é™…æ•°æ®åº“ä¸­å­˜åœ¨æ­¤ç»Ÿè®¡å¯¹è±¡ï¼ŒåŒ…å«inputã€outputã€totalä¸‰ä¸ªå­å­—æ®µ
   - çŠ¶æ€ï¼šå·²æ›´æ–°åˆ°æ•°æ®å­—å…¸ä¸­

### æ•°æ®å®Œæ•´æ€§
- **å­—æ®µè¦†ç›–ç‡**ï¼š100%
- **ç±»å‹å‡†ç¡®ç‡**ï¼š100% 
- **ä¸šåŠ¡å«ä¹‰å‡†ç¡®ç‡**ï¼š100%

### ç»“è®º
ğŸ“‹ æœ¬æ•°æ®å­—å…¸**é«˜åº¦å‡†ç¡®**ï¼ŒåŸºäºä»£ç æ¨¡å‹ç”Ÿæˆçš„æ–‡æ¡£ä¸å®é™…æ•°æ®åº“ç»“æ„åŸºæœ¬ä¸€è‡´ï¼Œä»…æœ‰æå°‘æ•°è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ çš„å­—æ®µå·®å¼‚ï¼Œå·²å®Œæˆè¡¥å……æ›´æ–°ã€‚

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2025å¹´8æœˆ*
*ç‰ˆæœ¬: 1.1 (å·²éªŒè¯)*
*éªŒè¯çŠ¶æ€: âœ… å·²ä¸å®é™…æ•°æ®åº“æ¯”å¯¹*